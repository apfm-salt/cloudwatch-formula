# https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-Configuration-File-Details.html

Linux:
  config_file: /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json
  config:
    metrics:
      metrics_collected:
        cpu:
          resources: ["*"]
          measurement:
            - name: cpu_usage_idle
              unit: Percent
            - name: cpu_usage_nice
              unit: Percent
          totalcpu: false
          metrics_collection_interval: 10
        netstat:
          measurement:
            - tcp_established
            - tcp_syn_sent
            - tcp_close
          metrics_collection_interval: 60
        disk:
          measurement:
            - used_percent
          resources: ["*"]
          drop_device: true
        processes:
          measurement:
            - running
            - sleeping
            - dead
      append_dimensions:
        ImageId: "${aws:ImageId}"
        InstanceId: "${aws:InstanceId}"
        InstanceType: "${aws:InstanceType}"
        AutoScalingGroupName: "${aws:AutoScalingGroupName}"
      aggregation_dimensions: [["ImageId"], ["InstanceId", "InstanceType"], []]
    logs:
      logs_collected:
        files:
          collect_list:
            - log_stream_name: system/{{ grains.id }}
              log_group_name: syslog
              file_path: /var/log/syslog
            - log_stream_name: kernel/{{ grains.id }}
              log_group_name: syslog
              file_path: /var/log/kern.log
            - log_stream_name: auth/{{ grains.id }}
              log_group_name: syslog
              file_path: /var/log/auth.log
            - log_stream_name: minion/{{ grains.id }}
              log_group_name: salt
              file_path: /var/log/salt/minion

Windows:
  config_file: '\ProgramData\Amazon\AmazonCloudWatchAgent\amazon-cloudwatch-agent.json'
  config:
    metrics:
      metrics_collected:
        Processor:
          measurement:
            - name: "% Idle Time"
              rename: "cpu_idle"
              unit: "Percent"
            - "% Interrupt Time"
            - "% User Time"
            - "% Processor Time"
          resources: ["*"]
          append_dimensions:
            d1: win_foo
            d2: win_bar
        LogicalDisk:
          measurement:
            - name: "% Idle Time"
              unit: "Percent"
            - name: "% Disk Read Time"
              rename: "disk_read"
            - "% Disk Write Time"
          resources: ["*"]
        Memory:
          metrics_collection_interval: 5
          measurement:
            - "Available Bytes"
            - "Cache Faults/sec"
            - "Page Faults/sec"
            - "Pages/sec"
        Network Interface:
          metrics_collection_interval: 5
          measurement:
            - "Bytes Received/sec"
            - "Bytes Sent/sec"
            - "Packets Received/sec"
            - "Packets Sent/sec"
          resources: ["*"]
        System:
          measurement:
            - "Context Switches/sec"
            - "System Calls/sec"
            - "Processor Queue Length"
      append_dimensions:
        ImageId: "${aws:ImageId}"
        InstanceId: "${aws:InstanceId}"
        InstanceType: "${aws:InstanceType}"
        AutoScalingGroupName: "${aws:AutoScalingGroupName}"
      aggregation_dimensions: [["ImageId"], ["InstanceId", "InstanceType"], []]
    logs:
      logs_collected:
        windows_events:
          collect_list:
            - event_name: System
              event_levels:
                - INFORMATION
                - ERROR
              log_group_name: System/{{ grains.id }}
              log_stream_name: System
